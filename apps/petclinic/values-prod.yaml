# Production environment overrides
# Inherits from values.yaml

replicaCount: 3

resources:
  requests:
    memory: "1Gi"
    cpu: "500m"
  limits:
    memory: "2Gi"
    cpu: "2000m"

autoscaling:
  enabled: true
  minReplicas: 3
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

podDisruptionBudget:
  enabled: true
  minAvailable: 2

env:
  - name: JAVA_OPTS
    value: "-XX:+UseContainerSupport -XX:MaxRAMPercentage=75.0 -XX:+HeapDumpOnOutOfMemoryError"
  - name: SPRING_PROFILES_ACTIVE
    value: "kubernetes,prod"
  - name: LOGGING_LEVEL_ROOT
    value: "WARN"

# Production ingress with TLS
ingress:
  enabled: true
  className: ""
  annotations:
    kubernetes.io/ingress.class: nginx
    cert-manager.io/cluster-issuer: letsencrypt-prod
  hosts:
    - host: petclinic.example.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: petclinic-tls
      hosts:
        - petclinic.example.com

# Pod topology spread for production
affinity:
  podAntiAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchExpressions:
            - key: app.kubernetes.io/name
              operator: In
              values:
                - petclinic
        topologyKey: topology.kubernetes.io/zone
